<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Stats - MiniMood</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŒ¸</text></svg>">
  <link rel="stylesheet" href="/css/style.css">
  <style>
    * {
      box-sizing: border-box;
    }
    
    .app-layout {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding-bottom: 70px;
    }

    .main-content {
      flex: 1;
      padding: var(--space-md);
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
    }

    .page-title {
      color: var(--pink-dark);
      margin-bottom: var(--space-md);
      text-align: center;
      font-size: 1.3rem;
    }

    .stats-overview {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-sm);
      margin-bottom: var(--space-lg);
    }

    .stat-card {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      text-align: center;
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }

    .stat-icon {
      width: 32px;
      height: 32px;
      margin: 0 auto var(--space-xs);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--pink-dark);
      line-height: 1;
    }

    .stat-label {
      color: var(--text);
      font-size: 0.75rem;
      margin-top: var(--space-xs);
    }

    .stats-section {
      background: var(--white);
      border-radius: var(--radius-lg);
      padding: var(--space-md);
      box-shadow: var(--shadow-sm);
      margin-bottom: var(--space-md);
    }

    .stats-section h2 {
      color: var(--pink-dark);
      margin-bottom: var(--space-md);
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      font-size: 1rem;
    }

    .top-moods {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .mood-stat {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .mood-stat-rank {
      width: 24px;
      height: 24px;
      background: var(--pink-light);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: var(--pink-dark);
      font-size: 0.75rem;
      flex-shrink: 0;
    }

    .mood-stat-icon {
      width: 32px;
      height: 32px;
      flex-shrink: 0;
    }

    .mood-stat-info {
      flex: 1;
      min-width: 0;
    }

    .mood-stat-name {
      font-weight: 500;
      color: var(--text-dark);
      font-size: 0.85rem;
    }

    .mood-stat-bar-container {
      height: 6px;
      background: var(--gray-light);
      border-radius: 3px;
      margin-top: 3px;
      overflow: hidden;
    }

    .mood-stat-bar {
      height: 100%;
      background: var(--gradient-primary);
      border-radius: 3px;
      transition: width 0.5s ease;
    }

    .mood-stat-count {
      font-weight: 600;
      color: var(--pink-dark);
      min-width: 40px;
      text-align: right;
      font-size: 0.85rem;
    }

    .all-moods-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-xs);
      margin-top: var(--space-md);
    }

    .mood-tile {
      background: var(--gray-light);
      border-radius: var(--radius-sm);
      padding: var(--space-xs);
      text-align: center;
      transition: var(--transition);
    }

    .mood-tile:hover {
      background: var(--pink-light);
    }

    .mood-tile.unused {
      opacity: 0.4;
    }

    .mood-tile img {
      width: 28px;
      height: 28px;
      margin-bottom: 2px;
    }

    .mood-tile-name {
      font-size: 0.6rem;
      color: var(--text);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .mood-tile-count {
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--pink-dark);
    }

    .empty-stats {
      text-align: center;
      padding: var(--space-xl);
    }

    .empty-stats img {
      width: 70px;
      opacity: 0.5;
      margin-bottom: var(--space-md);
    }

    .empty-stats h3 {
      color: var(--text);
      margin-bottom: var(--space-xs);
      font-size: 1.1rem;
    }

    .empty-stats p {
      color: var(--gray-dark);
      margin-bottom: var(--space-md);
      font-size: 0.9rem;
    }

    .insights {
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
    }

    .insight-card {
      background: var(--lavender);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
    }

    .insight-card img {
      width: 32px;
      height: 32px;
      flex-shrink: 0;
    }

    .insight-content h4 {
      color: var(--pink-dark);
      margin-bottom: 2px;
      font-size: 0.9rem;
    }

    .insight-content p {
      font-size: 0.8rem;
      color: var(--text);
    }

    .loading-stats {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--space-xl);
    }

    .bottom-nav {
      display: flex;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--white);
      border-top: 1px solid var(--gray);
      padding: var(--space-xs) 0;
      z-index: 100;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }

    .bottom-nav-link {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 2px;
      text-decoration: none;
      color: var(--gray-dark);
      padding: var(--space-xs);
      font-size: 0.65rem;
      transition: var(--transition);
    }

    .bottom-nav-link.active {
      color: var(--pink-dark);
    }

    .bottom-nav-link svg {
      width: 20px;
      height: 20px;
    }

    .nav {
      display: none;
    }

    @media (min-width: 480px) {
      .all-moods-grid {
        grid-template-columns: repeat(5, 1fr);
      }
      
      .mood-tile img {
        width: 32px;
        height: 32px;
      }
      
      .mood-tile-name {
        font-size: 0.65rem;
      }
    }

    @media (min-width: 768px) {
      .nav {
        display: flex;
      }
      
      .bottom-nav {
        display: none;
      }
      
      .app-layout {
        padding-bottom: 0;
      }
      
      .main-content {
        padding: var(--space-lg);
      }
      
      .page-title {
        font-size: 1.75rem;
      }
      
      .stats-overview {
        grid-template-columns: repeat(4, 1fr);
      }
      
      .stat-value {
        font-size: 2rem;
      }
      
      .all-moods-grid {
        grid-template-columns: repeat(8, 1fr);
        gap: var(--space-sm);
      }
      
      .mood-tile img {
        width: 36px;
        height: 36px;
      }
      
      .insights {
        flex-direction: row;
      }
      
      .insight-card {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <div class="app-layout">
    <!-- Navigation -->
    <nav class="nav">
      <a href="/home" class="nav-brand">
        <span>ðŸŒ¸</span>
        <span>MiniMood</span>
      </a>
      <div class="nav-links">
        <a href="/home" class="nav-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
            <polyline points="9 22 9 12 15 12 15 22"/>
          </svg>
          <span>Home</span>
        </a>
        <a href="/calendar" class="nav-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
            <line x1="16" y1="2" x2="16" y2="6"/>
            <line x1="8" y1="2" x2="8" y2="6"/>
            <line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <span>Calendar</span>
        </a>
        <a href="/stats" class="nav-link active">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="20" x2="18" y2="10"/>
            <line x1="12" y1="20" x2="12" y2="4"/>
            <line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          <span>Stats</span>
        </a>
        <button class="btn btn-secondary btn-small" onclick="api.logout()">Logout</button>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <h1 class="page-title">Your Mood Statistics</h1>

      <div id="stats-content">
        <div class="loading-stats">
          <div class="spinner"></div>
          <p class="mt-md text-muted">Loading your stats...</p>
        </div>
      </div>
    </main>

    <nav class="bottom-nav">
      <a href="/home" class="bottom-nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
        <span>Home</span>
      </a>
      <a href="/calendar" class="bottom-nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/>
          <line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        <span>Calendar</span>
      </a>
      <a href="/stats" class="bottom-nav-link active">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="20" x2="18" y2="10"/>
          <line x1="12" y1="20" x2="12" y2="4"/>
          <line x1="6" y1="20" x2="6" y2="14"/>
        </svg>
        <span>Stats</span>
      </a>
      <a href="#" onclick="api.logout()" class="bottom-nav-link">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
        <span>Logout</span>
      </a>
    </nav>
  </div>

  <script src="/js/api.js"></script>
  <script>
    if (!api.requireAuth()) {
    }

    const allMoods = [
      { id: 1, name: 'Happy', file: '1_Happy.png' },
      { id: 2, name: 'Sad', file: '2_Sad.png' },
      { id: 3, name: 'Angry', file: '3_Angry.png' },
      { id: 4, name: 'Anxious', file: '4_Anxious.png' },
      { id: 5, name: 'Stressed', file: '5_Stressed.png' },
      { id: 6, name: 'Calm', file: '6_Calm.png' },
      { id: 7, name: 'Excited', file: '7_Excited.png' },
      { id: 8, name: 'Bored', file: '8_Bored.png' },
      { id: 9, name: 'Tired', file: '9_Tired.png' },
      { id: 10, name: 'Energetic', file: '10_Energetic.png' },
      { id: 11, name: 'Motivated', file: '11_Motivated.png' },
      { id: 12, name: 'Unmotivated', file: '12_Unmotivated.png' },
      { id: 13, name: 'Focused', file: '13_Focused.png' },
      { id: 14, name: 'Distracted', file: '14_Distracted.png' },
      { id: 15, name: 'Confused', file: '15_Confused.png' },
      { id: 16, name: 'Overwhelmed', file: '16_Overwhelmed.png' },
      { id: 17, name: 'Relaxed', file: '17_Relaxed.png' },
      { id: 18, name: 'Lonely', file: '18_Lonely.png' },
      { id: 19, name: 'Hopeful', file: '19_Hopeful.png' },
      { id: 20, name: 'Grateful', file: '20_Grateful.png' },
      { id: 21, name: 'Frustrated', file: '21_Frustrated.png' },
      { id: 22, name: 'Irritated', file: '22_Irritated.png' },
      { id: 23, name: 'Confident', file: '23_Confident.png' },
      { id: 24, name: 'Nervous', file: '24_Nervous.png' },
      { id: 25, name: 'Scared', file: '25_Scared.png' },
      { id: 26, name: 'Shocked', file: '26_Shocked.png' },
      { id: 27, name: 'Proud', file: '27_Proud.png' },
      { id: 28, name: 'Disappointed', file: '28_Disappointed.png' },
      { id: 29, name: 'Guilty', file: '29_Guilty.png' },
      { id: 30, name: 'Peaceful', file: '30_Peaceful.png' },
      { id: 31, name: 'Love', file: '31_Love.png' },
      { id: 32, name: 'Heartbroken', file: '32_Heartbroken.png' },
      { id: 33, name: 'Inspired', file: '33_Inspired.png' },
      { id: 34, name: 'Productive', file: '34_Productive.png' },
      { id: 35, name: 'Lazy', file: '35_Lazy.png' },
      { id: 36, name: 'Sick', file: '36_Sick.png' },
      { id: 37, name: 'Disgusted', file: '37_Disgusted.png' },
      { id: 38, name: 'Sleepy', file: '38_Sleepy.png' },
      { id: 39, name: 'Restless', file: '39_Restless.png' },
      { id: 40, name: 'Neutral', file: '40_Neutral.png' }
    ];

    const statsContent = document.getElementById('stats-content');

    async function init() {
      try {
        const data = await api.getStats();
        render(data.stats);
      } catch (error) {
        console.error('Failed to load stats:', error);
        statsContent.innerHTML = `
          <div class="empty-stats">
            <img src="/emojis/2_Sad.png" alt="Error">
            <h3>Oops!</h3>
            <p>Failed to load your stats. Please try again.</p>
            <button class="btn btn-primary" onclick="location.reload()">Retry</button>
          </div>
        `;
      }
    }

    function render(stats) {
      if (stats.totalEntries === 0) {
        statsContent.innerHTML = `
          <div class="empty-stats">
            <img src="/emojis/40_Neutral.png" alt="No data">
            <h3>No Data Yet</h3>
            <p>Start logging your mood to see your statistics!</p>
            <a href="/home" class="btn btn-primary">Log Your First Mood</a>
          </div>
        `;
        return;
      }

      const maxCount = stats.moodFrequency.length > 0 ? stats.moodFrequency[0].count : 1;

      const moodCounts = {};
      stats.moodFrequency.forEach(m => {
        moodCounts[m.mood.id] = m.count;
      });

      const topMood = stats.moodFrequency[0]?.mood;
      const uniqueMoods = stats.moodFrequency.length;

      let html = `
        <div class="stats-overview">
          <div class="stat-card">
            <img src="/emojis/34_Productive.png" alt="Entries" class="stat-icon">
            <div class="stat-value">${stats.totalEntries}</div>
            <div class="stat-label">Total Entries</div>
          </div>
          <div class="stat-card">
            <img src="/emojis/7_Excited.png" alt="Streak" class="stat-icon">
            <div class="stat-value">${stats.currentStreak}</div>
            <div class="stat-label">Day Streak</div>
          </div>
          <div class="stat-card">
            <img src="/emojis/23_Confident.png" alt="Moods" class="stat-icon">
            <div class="stat-value">${uniqueMoods}</div>
            <div class="stat-label">Unique Moods</div>
          </div>
          <div class="stat-card">
            <img src="${topMood ? `/emojis/${topMood.file}` : '/emojis/40_Neutral.png'}" alt="Top Mood" class="stat-icon">
            <div class="stat-value" style="font-size: 1.25rem;">${topMood?.name || 'N/A'}</div>
            <div class="stat-label">Most Common</div>
          </div>
        </div>

        <div class="stats-section">
          <h2>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"/>
              <line x1="12" y1="16" x2="12" y2="12"/>
              <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            Insights
          </h2>
          <div class="insights">
            ${topMood ? `
              <div class="insight-card">
                <img src="/emojis/${topMood.file}" alt="${topMood.name}">
                <div class="insight-content">
                  <h4>Your Top Mood</h4>
                  <p>You've felt <strong>${topMood.name}</strong> the most (${stats.moodFrequency[0].count} times). ${getInsightMessage(topMood.name)}</p>
                </div>
              </div>
            ` : ''}
            <div class="insight-card">
              <img src="/emojis/11_Motivated.png" alt="Variety">
              <div class="insight-content">
                <h4>Emotional Range</h4>
                <p>You've used ${uniqueMoods} out of 40 moods. ${uniqueMoods >= 20 ? 'Great emotional awareness!' : 'Try exploring more moods!'}</p>
              </div>
            </div>
            ${stats.currentStreak >= 7 ? `
              <div class="insight-card">
                <img src="/emojis/27_Proud.png" alt="Streak">
                <div class="insight-content">
                  <h4>Amazing Streak!</h4>
                  <p>You've logged ${stats.currentStreak} days in a row. Keep up the great habit!</p>
                </div>
              </div>
            ` : ''}
          </div>
        </div>

        <div class="stats-section">
          <h2>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
            </svg>
            Top Moods
          </h2>
          <div class="top-moods">
            ${stats.moodFrequency.slice(0, 5).map((item, index) => `
              <div class="mood-stat">
                <div class="mood-stat-rank">${index + 1}</div>
                <img src="/emojis/${item.mood.file}" alt="${item.mood.name}" class="mood-stat-icon">
                <div class="mood-stat-info">
                  <div class="mood-stat-name">${item.mood.name}</div>
                  <div class="mood-stat-bar-container">
                    <div class="mood-stat-bar" style="width: ${(item.count / maxCount) * 100}%"></div>
                  </div>
                </div>
                <div class="mood-stat-count">${item.count}</div>
              </div>
            `).join('')}
          </div>
        </div>

        <div class="stats-section">
          <h2>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="7" height="7"/>
              <rect x="14" y="3" width="7" height="7"/>
              <rect x="14" y="14" width="7" height="7"/>
              <rect x="3" y="14" width="7" height="7"/>
            </svg>
            All Moods
          </h2>
          <div class="all-moods-grid">
            ${allMoods.map(mood => {
              const count = moodCounts[mood.id] || 0;
              return `
                <div class="mood-tile ${count === 0 ? 'unused' : ''}">
                  <img src="/emojis/${mood.file}" alt="${mood.name}">
                  <div class="mood-tile-name">${mood.name}</div>
                  <div class="mood-tile-count">${count}</div>
                </div>
              `;
            }).join('')}
          </div>
        </div>
      `;

      statsContent.innerHTML = html;
    }

    function getInsightMessage(moodName) {
      const messages = {
        'Happy': 'That\'s wonderful! Keep spreading positivity.',
        'Sad': 'Remember, it\'s okay to feel down sometimes.',
        'Angry': 'Consider healthy outlets for your frustration.',
        'Anxious': 'Try some breathing exercises when you feel this way.',
        'Stressed': 'Remember to take breaks and practice self-care.',
        'Calm': 'You seem to have great inner peace!',
        'Excited': 'Your enthusiasm is contagious!',
        'Grateful': 'Gratitude is the key to happiness!',
        'Peaceful': 'You\'ve found your zen!',
        'Love': 'Love makes the world go round!'
      };
      return messages[moodName] || 'Keep tracking your emotions!';
    }

    init();
  </script>
</body>
</html>
